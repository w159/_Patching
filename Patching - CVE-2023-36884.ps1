<#
.SYNOPSIS
    CVE-2023-36884 - Office and Windows HTML Remote Code Execution Vulnerability
    https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-36884

.DESCRIPTION
This script checks for the Zero Day CVE-2023-36884 - Office and Windows HTML Remote Code Execution Vulnerability

.EXAMPLE
Import and/or run this script as is, or use it as a reference to create your own script.

irm -UseBasicParsing 'https://raw.githubusercontent.com/w159/_Patching/main/Patching%20-%20CVE-2023-36884.ps1' | iex

.NOTES
Successful execution of this script will also patch the following CVEs:
CVE-2023-33149
CVE-2023-33152
CVE-2023-33153
CVE-2023-33148
CVE-2023-33158
CVE-2023-33162
CVE-2023-33161
CVE-2023-35311
CVE-2023-33150
CVE-2023-33151

#>

# Check for registry key - Block cross protocol file navigation
$RegistryKey = 'HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_BLOCK_CROSS_PROTOCOL_FILE_NAVIGATION'
$Registry_CHECK = Test-Path -Path $RegistryKey
$Processes = @('Excel.exe', 'Graph.exe', 'MSAccess.exe', 'MSPub.exe', 'Powerpnt.exe', 'Visio.exe', 'WinProj.exe', 'Wordpad.exe')
If ($Registry_CHECK -eq $false)
{
    Write-Host 'Vulnerable - Creating registry key' -ForegroundColor Yellow
    New-Item -Path $RegistryKey -Force
    foreach ($Process in $Processes)
    {
        Write-Host "Adding $Process to registry key" -ForegroundColor Yellow
        New-ItemProperty -Path $RegistryKey -Name $Process -Value 1 -PropertyType DWORD -Force
    }
}
else
{
    Write-Host 'Mitigated - Registry key exists' -ForegroundColor Green
}

# Check for vulnerable Office versions
$Office_CHECK = (Get-CimInstance win32_product | Where-Object { $_.Name -like '*Office*' } | Where-Object Version -Like '16.0.*').Version
$OfficeUpdateClient = (Get-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Office\ClickToRun\Updates' -Name 'UpdateClientPath').UpdateClientPath
$UpdateCommand = '/update user displaylevel=false forceappshutdown=true updatepromptuser=false'
If ($Office_CHECK -notlike '*16529.20182')
{
    # Check for and install the latest Office update
    Write-Host 'Vulnerable - Installing the latest Office update' -ForegroundColor Yellow
    Start-Process -FilePath $OfficeUpdateClient -ArgumentList $UpdateCommand -Wait
}
else
{
    Write-Host 'Mitigated - Office is up to date' -ForegroundColor Green
}



